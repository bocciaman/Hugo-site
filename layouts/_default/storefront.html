{{ define "main" }}
<main class="storefront">
  <style>
    /* STORE FRONT LAYOUT ONLY */
    .storefront .storefront-layout{
      display:grid;
      grid-template-columns: 280px 1fr;
      gap: 28px;
      align-items:start;
    }

    /* Sidebar */
    .storefront .storefront-sidebar{
      position: sticky;
      top: 24px;
      align-self:start;
    }

    .storefront .sf-box{
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 14px;
      padding: 14px;
      margin-bottom: 16px;
      background: white;
    }

    .storefront .sf-search{
      width:100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,.15);
    }

    .storefront .sf-title{
      margin: 0 0 10px;
      font-size: 1.05rem;
    }

    .storefront .sf-check{
      display:flex;
      gap: 10px;
      align-items:center;
      margin: 8px 0;
    }

    /* Header */
    .storefront .sf-page-title{ margin: 0 0 8px; }
    .storefront .sf-intro{ max-width: 70ch; opacity: .9; margin-bottom: 18px; }

    /* Grid like your example */
    .storefront .product-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 22px;
    }

    /* Cards */
    .storefront .product-card{
      border:1px solid rgba(0,0,0,.10);
      border-radius: 14px;
      padding: 16px;
      background: white;
    }

    .storefront .product-img{
      width:100%;
      height: 190px;
      object-fit: contain;
      border-radius: 12px;
      background: rgba(0,0,0,.03);
      padding: 10px;
      margin-bottom: 12px;
    }

    .storefront .product-name{ margin: 0 0 8px; font-size: 1.05rem; }
    .storefront .product-desc{ margin: 0; opacity: .85; font-size: .95rem; }

    /* Responsive */
    @media (max-width: 980px){
      .storefront .storefront-layout{ grid-template-columns: 1fr; }
      .storefront .storefront-sidebar{ position: static; top: auto; }
      .storefront .product-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    @media (max-width: 600px){
      .storefront .product-grid{ grid-template-columns: 1fr; }
    }
  </style>

  <div class="storefront-layout">

    <!-- LEFT SIDEBAR -->
    <aside class="storefront-sidebar">
      <div class="sf-box">
        <input id="sfSearch" class="sf-search" type="search" placeholder="Search products..." />
      </div>

      <!-- Categories (checkbox filter) -->
      <div class="sf-box">
        <h3 class="sf-title">Categories</h3>
        <!-- IMPORTANT: Start unchecked so "no category checked" shows all items -->
        <label class="sf-check"><input type="checkbox" value="gear"> Gear</label>
        <label class="sf-check"><input type="checkbox" value="studio"> Studio</label>
        <label class="sf-check"><input type="checkbox" value="setup"> Setup</label>
      </div>
    </aside>

    <!-- RIGHT CONTENT -->
    <section class="storefront-content">
      <header class="sf-header">
        <h1 class="sf-page-title">{{ .Title }}</h1>
        {{ if .Content }}
          <div class="sf-intro">{{ .Content }}</div>
        {{ end }}
      </header>

      <div id="sfGrid" class="product-grid">
        {{ range site.Data.products.items }}
          <article class="product-card"
            data-name="{{ .name | lower }}"
            data-categories="{{ with .categories }}{{ delimit . "," }}{{ end }}">
            <a class="product-link" href="{{ .link }}" target="_blank" rel="nofollow noopener">
              <img class="product-img" src="{{ .image }}" alt="{{ .name }}">
              <h3 class="product-name">{{ .name }}</h3>
            </a>
            {{ if .desc }}
              <p class="product-desc">{{ .desc }}</p>
            {{ end }}
          </article>
        {{ end }}
      </div>
    </section>

  </div>

  <!-- Search + category filtering (page-scoped) -->
  <script>
  (function () {
    const search = document.getElementById('sfSearch');
    const cards = Array.from(document.querySelectorAll('#sfGrid .product-card'));
    const checkboxes = Array.from(document.querySelectorAll('.sf-check input'));

    function filterProducts() {
      const q = (search && search.value ? search.value : '').trim().toLowerCase();

      // Gather checked categories
      const activeCategories = checkboxes
        .filter(cb => cb.checked)
        .map(cb => cb.value);

      cards.forEach(card => {
        const name = (card.getAttribute('data-name') || '').toLowerCase();

        // Normalize categories to lowercase + trimmed
        const categories = (card.getAttribute('data-categories') || '')
          .split(',')
          .map(s => s.trim().toLowerCase())
          .filter(Boolean);

        const matchesSearch = name.includes(q);

        // YOUR REQUESTED BEHAVIOR:
        // - If NO categories checked => show ALL items (that match search)
        // - If categories checked => show ONLY items in ANY checked category (AND match search)
        const matchesCategory = activeCategories.length === 0
          ? true
          : activeCategories.some(cat => categories.includes(cat.toLowerCase()));

        card.style.display = (matchesSearch && matchesCategory) ? '' : 'none';
      });
    }

    if (search) search.addEventListener('input', filterProducts);
    checkboxes.forEach(cb => cb.addEventListener('change', filterProducts));

    // Apply on initial load
    filterProducts();
  })();
  </script>

</main>
{{ end }}